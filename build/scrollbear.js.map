{"version":3,"sources":["rAF.js","scrollbear.js","index.js"],"names":[],"mappings":"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","file":"scrollbear.js","sourcesContent":["(function() {\n  var lastTime = 0\n  var vendors = ['ms', 'moz', 'webkit', 'o']\n  for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame']\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n                                   window[vendors[x] + 'CancelRequestAnimationFrame']\n  }\n\n  if (!window.requestAnimationFrame)\n    window.requestAnimationFrame = function(callback, element) {\n      var currTime = new Date().getTime()\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime))\n      var id = window.setTimeout(function() { callback(currTime + timeToCall); },\n          timeToCall)\n      lastTime = currTime + timeToCall\n      return id\n    }\n\n  if (!window.cancelAnimationFrame)\n    window.cancelAnimationFrame = function(id) {\n      clearTimeout(id)\n    }\n}())\n","import {} from './rAF.js'\n\nvar Scrollbear = (function(window, document) {\n  var run\n  function start(\n    target = document.body,\n    changedItem = target.querySelectorAll('img')) {\n    var unloadItems = Array.from(changedItem || []).map(img => { return {dom: img, calculatedHeight: 0} })\n    var oldHeight = Array.from(target.childNodes).reduce(accumulateHeight, 0)\n\n    run = true\n    // use closure to share the scope\n    var frame = function() {\n      if (!run) return\n      window.requestAnimationFrame(frame)\n\n      var newHeight = Array.from(target.childNodes).reduce(accumulateHeight, 0)\n      // save the normal scroll position\n      var scroll = getScroll(target)\n      // container height change, means there's a image loaded\n      if (isHeightChange(oldHeight, newHeight)) {\n        // get loaded image, then determine if it's above the viewport\n        if (getLoadedItems(unloadItems)\n          .filter(item => item.dom.offsetTop < scroll)\n          .map(markLoadedItems).length > 0) {\n          // mark that part of item height is already be calculated\n          // unloadItems = markLoadedItems(unloadItems)\n          // return to normal scroll position, avoid the page jump\n          // there's only part we set the value of style, avoid sync layout threashing\n          returnScroll(target, scroll + (newHeight - oldHeight))\n        }\n      }\n      oldHeight = newHeight\n    }\n    return window.requestAnimationFrame(frame)\n  }\n  function stop() {\n    run = false\n  }\n  function assign(target, prop, value) {\n    target[prop] = value\n    return target\n  }\n  function accumulateHeight(total, content) {\n    return total + (content.offsetHeight || 0)\n  }\n  function isHeightChange(oldHeight, newHeight) {\n    return oldHeight !== newHeight\n  }\n  function getScroll(target) {\n    return target.scrollTop || window.scrollY\n  }\n  function returnScroll(target, pos) {\n    console.log(window.scrollY);\n    // document's scrollTop is undefined, and body will not scroll\n    // in these cases, we will scroll the whole window\n    if (typeof target.scrollTop === 'undefined' || target === document.body)\n      window.scrollTo(0, pos)\n    else\n      target.scrollTop = pos\n  }\n  function markLoadedItems(item) {\n    return assign(item, 'calculatedHeight', item.dom.offsetHeight)\n  }\n  function getLoadedItems(items) {\n    return items.filter(item => item.dom.offsetHeight > item.calculatedHeight)\n  }\n  // Public APIs\n  return {\n    start,\n    stop\n  }\n})(window, document)\nexport default Scrollbear\n","import Scrollbear from './scrollbear'\nwindow.Scrollbear = Scrollbear\n"],"sourceRoot":"/source/"}