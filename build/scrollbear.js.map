{"version":3,"file":"scrollbear.js","sources":["scrollbear.js","index.js"],"sourcesContent":["var Scrollbear = (function(window, document) {\n  var run\n  function start(\n    target = document.body,\n    changedItem = target.querySelectorAll('img')) {\n    var scroller = target\n    var unloadItems = Array.from(changedItem || []).map(img => { return {dom: img, caculatedHeight: 0} })\n    var oldHeight = Array.from(scroller.childNodes).reduce(accumulateHeight, 0)\n\n    run = true\n    // use closure to share the scope\n    var frame = function() {\n      if (!run) return\n      window.requestAnimationFrame(frame)\n\n      var newHeight = Array.from(scroller.childNodes).reduce(accumulateHeight, 0)\n      // save the normal scroll position\n      var scroll = getScroll(scroller)\n      // container height change, means there's a image loaded\n      if (isHeightChange(oldHeight, newHeight)) {\n        // get loaded image, then determine if it's above the viewport\n        if (getLoadedItems(unloadItems)\n          .filter(item => item.dom.offsetTop < scroll)\n          .map(markLoadedItems).length > 0) {\n          // mark that part of item height is already be calculated\n          // unloadItems = markLoadedItems(unloadItems)\n          // return to normal scroll position, avoid the page jump\n          // there's only part we set the value of style, avoid sync layout threashing\n          returnScroll(scroller, scroll + (newHeight - oldHeight))\n        }\n      }\n      oldHeight = newHeight\n    }\n    return window.requestAnimationFrame(frame)\n  }\n  function stop() {\n    run = false\n  }\n  function assign(target, prop, value) {\n    target[prop] = value\n    return target\n  }\n  function accumulateHeight(total, content) {\n    return total + (content.offsetHeight || 0)\n  }\n  function isHeightChange(oldHeight, newHeight) {\n    return oldHeight !== newHeight\n  }\n  function getScroll(target) {\n    return target.scrollTop || window.scrollY\n  }\n  function returnScroll(target, pos) {\n    // document's scrollTop is undefined, and body will not scroll\n    // in these cases, we will scroll the whole window\n    if (typeof target.scrollTop === 'undefined' || target === document.body)\n      window.scrollTo(0, pos)\n    else\n      target.scrollTop = pos\n  }\n  function markLoadedItems(item) {\n    return assign(item, 'caculatedHeight', item.dom.offsetHeight)\n  }\n  function getLoadedItems(items) {\n    return items.filter(item => item.dom.offsetHeight > item.caculatedHeight)\n  }\n  // Public APIs\n  return {\n    start,\n    stop\n  }\n})(window, document)\nexport default Scrollbear\n","import Scrollbear from './scrollbear'\nwindow.Scrollbear = Scrollbear\n"],"names":[],"mappings":"AAAA,IAAI,UAAU,GAAG,CAAC,SAAS,MAAM,EAAE,QAAQ,EAAE;EAC3C,IAAI,GAAG;EACP,SAAS,KAAK;IACZ,MAAM,GAAG,QAAQ,CAAC,IAAI;IACtB,WAAW,GAAG,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,EAAE;IAC9C,IAAI,QAAQ,GAAG,MAAM;IACrB,IAAI,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,GAAG,IAAI,EAAE,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,eAAe,EAAE,CAAC,CAAC,EAAE,CAAC;IACrG,IAAI,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC;;IAE3E,GAAG,GAAG,IAAI;;IAEV,IAAI,KAAK,GAAG,WAAW;MACrB,IAAI,CAAC,GAAG,EAAE,MAAM;MAChB,MAAM,CAAC,qBAAqB,CAAC,KAAK,CAAC;;MAEnC,IAAI,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC,CAAC;;MAE3E,IAAI,MAAM,GAAG,SAAS,CAAC,QAAQ,CAAC;;MAEhC,IAAI,cAAc,CAAC,SAAS,EAAE,SAAS,CAAC,EAAE;;QAExC,IAAI,cAAc,CAAC,WAAW,CAAC;WAC5B,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,MAAM,CAAC;WAC3C,GAAG,CAAC,eAAe,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE;;;;;UAKlC,YAAY,CAAC,QAAQ,EAAE,MAAM,GAAG,CAAC,SAAS,GAAG,SAAS,CAAC,CAAC;SACzD;OACF;MACD,SAAS,GAAG,SAAS;KACtB;IACD,OAAO,MAAM,CAAC,qBAAqB,CAAC,KAAK,CAAC;GAC3C;EACD,SAAS,IAAI,GAAG;IACd,GAAG,GAAG,KAAK;GACZ;EACD,SAAS,MAAM,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE;IACnC,MAAM,CAAC,IAAI,CAAC,GAAG,KAAK;IACpB,OAAO,MAAM;GACd;EACD,SAAS,gBAAgB,CAAC,KAAK,EAAE,OAAO,EAAE;IACxC,OAAO,KAAK,GAAG,CAAC,OAAO,CAAC,YAAY,IAAI,CAAC,CAAC;GAC3C;EACD,SAAS,cAAc,CAAC,SAAS,EAAE,SAAS,EAAE;IAC5C,OAAO,SAAS,KAAK,SAAS;GAC/B;EACD,SAAS,SAAS,CAAC,MAAM,EAAE;IACzB,OAAO,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,OAAO;GAC1C;EACD,SAAS,YAAY,CAAC,MAAM,EAAE,GAAG,EAAE;;;IAGjC,IAAI,OAAO,MAAM,CAAC,SAAS,KAAK,WAAW,IAAI,MAAM,KAAK,QAAQ,CAAC,IAAI;MACrE,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC;;MAEvB,MAAM,CAAC,SAAS,GAAG,GAAG;GACzB;EACD,SAAS,eAAe,CAAC,IAAI,EAAE;IAC7B,OAAO,MAAM,CAAC,IAAI,EAAE,iBAAiB,EAAE,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC;GAC9D;EACD,SAAS,cAAc,CAAC,KAAK,EAAE;IAC7B,OAAO,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC;GAC1E;;EAED,OAAO;IACL,KAAK;IACL,IAAI;GACL;CACF,CAAC,CAAC,MAAM,EAAE,QAAQ,CAAC;;ACrEpB,MAAM,CAAC,UAAU,GAAG,UAAU","sourceRoot":"/source/"}